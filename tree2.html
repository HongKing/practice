<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>tree</title>
</head>
<body>
<script>
	function BTree(list,parent){
		this.key=list[0].key;
		this.values=[list[0].value];
		this.parent=parent||null;
		this.left=null;
		this.right=null;
		for(var i=1,len=list.length;i<len;i++){
			this.add(list[i]);
		}
	}
	BTree.prototype={
		add:function(item){
			var self=this;
			if(self.key==item.key){
				self.values.push(item.value);
				return self;
			} else if(self.key>item.key){
				if(!self.left){
					return self.left=new BTree([item],self);
				} else {
					return self.left.add(item);
				}
			} else {
				if(!self.right){
					return self.right=new BTree([item],self);
				} else {
					return self.right.add(item);
				}
			}
		},
		//查找是否包含key的节点
		contain:function(key){
			if(this.key==key){
				return this;
			} else if(this.key>key){
				return this.left?this.left.contain(key):null;
			} else {
				return this.right?this.right.contain(key):null;
			}
		},
		//范围查找
		searchRange:function(min,max){
			var list=[];
			search.call(this,min,max);
			return list;

			function search(min,max){
				if(this.key>min){//遍历左子树
					this.left&&search.call(this.left,min,max);
				}
				if(this.key>=min&&this.key<=max){
					list.push(this);
				}
				if(this.key<max){//遍历右子树
					this.right&&search.call(this.right,min,max);
				}
			}
		},
		remove:function(key,value){
			if(this.key==key){
				if(this.values.length>1){
					this.values.splice(this.values.indexOf(value),1);
				} else if(this.left&&this.right){
					var node=this.right;
					while (node.left) {//找到最左的节点
						node=node.left;
					}

					var dNode=this.remove(node.key,value);
					if(this.key==node.parent.key){//没有左节点的情况，直接将右子树上移
						this.key=node.key;
						this.right=node.right;
					} else {//有左节点的情况
						this.key=node.key;
						if(node.right){//如果还存在右节点，将右节点上移
							node.right.parent=node.parent;
							node=node.right;
						} else {//直接将该节点清除
							node.parent.left=null;
						}
					}
				} else {
					var prop=this.parent.key>this.key?'left':'right';
					if(this.left) {//只有左子树
						this.left.parent=this.parent;
						this.parent[prop]=this.left;
					} else if(this.right){//只有右子树
						this.right.parent=this.parent;
						this.parent[prop]=this.right;
					} else {//叶子节点
						this.parent[prop]=null;
					}
				}
				return this;
			}  else if(this.key>key){
				return this.left?this.left.remove(key,value):null;
			} else {
				return this.right?this.right.remove(key,value):null;
			}
		}
	};

	var tree=new BTree([
			{key:5,value:'a'},
			{key:4,value:'b'},
			{key:6,value:'c'},
			{key:7,value:'e'},
			{key:3,value:'f'},
			{key:8,value:'g'},
			{key:5,value:'d'}
		]).contain(5);
	console.log(tree.remove(5,'d'));
	console.log(tree);
	// console.log(tree.searchRange(4,7));
</script>
</body>
</html>