<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>拖曳滑动切换页面</title>
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<style>
		html,body,.container,.pg{
			width: 100%;height: 100%;padding: 0;margin: 0;
		}
		.container{position: relative;overflow: hidden;}
		.pg{position: absolute;top: 0;left: 0;}
		.pg:nth-child(1){display: block;}
		.pg:nth-child(2),.pg:nth-child(3){display: none;}
		.pg1{
			background-color: #ccc;
		}
		.pg2{
			background-color: #bbb;
		}
		.pg3{
			background-color: #aaa;
		}
/*		.restore{-webkit-transition:-webkit-transform .3s linear;}
		.moving{-webkit-transition:-webkit-transform .2s linear;}*/
	</style>
</head>
<body>
<div class="container">
	<div class="pg pg1">
		<h2>page1</h2>
	</div>
	<div class="pg pg2">
		<h2>page2</h2>
	</div>
	<div class="pg pg3">
		<h2>page3</h2>
	</div>
</div>
<script>

var addCssRule = function() {
  // 创建一个 style， 返回其 stylesheet 对象
  // 注意：IE6/7/8中使用 style.stylesheet/addRule，其它浏览器 style.sheet/insertRule
  var sheet=function() {
    var head = document.head || document.getElementsByTagName('head')[0];
    var style = document.createElement('style');
    style.type = 'text/css';
    head.appendChild(style);
    return style.sheet;
    // return style.sheet||style.stylesheet;//ie
  }();
  // 返回接口函数
  return function(cssText) {
    var cssRules=cssText.split('\r\n');
    var len=!!sheet.cssRules?sheet.cssRules.length:0;
    for(var i=0;i<cssRules.length;i++){
      if (sheet.insertRule) {  
          sheet.insertRule(cssRules[i], len++);
      } 
      // else if (sheet.addRule) {
      //     sheet.addRule(selector, rules, index);//ie
      // }
    }
  }
}();


addCssRule('.restore{-webkit-transition:-webkit-transform .3s linear;}');
addCssRule('.moving{-webkit-transition:-webkit-transform .2s linear;}');
	//页面滚动效果
	var con=document.getElementsByClassName('container')[0];
	var pgs=document.getElementsByClassName('pg');
	var len=pgs.length,curr=0,prev=-1,next=1,act=0;
	var isLock=false,sx=0,sy=0,mx=0,my=0,offset=0;
	var touchStart=function(e){
		if(isLock){return;}
		var touches=e.changedTouches||e.targetTouches;
		sx=touches[0].pageX;sy=touches[0].pageY;
		con.addEventListener('touchmove', touchMove,false);
	},
	touchMove=function(e){
		if(isLock){return;}
		var touches=e.changedTouches||e.targetTouches;
		mx=touches[0].pageX;my=touches[0].pageY;
		offset=my-sy;
		if(curr==0&&offset>0||curr==len-1&&offset<0){
			con.removeEventListener('touchmove', touchMove,false);
			return;
		}
		con.addEventListener('touchend', release,false);
		con.addEventListener('touchcancel', release,false);
		e.preventDefault();
		e.stopPropagation();
		if(offset>0){
			act=prev;
			pgs[next]&&(pgs[next].style.display='none');
			pgs[prev].style.cssText='display:block;top:-100%;';
			pgs[curr].style['-webkit-transform']=pgs[prev].style['-webkit-transform']='translate3d(0,'+offset+'px,0)';
		} else if(offset<0){
			act=next;
			pgs[prev]&&(pgs[prev].style.display='none');
			pgs[next].style.cssText='display:block;top:100%;';
			pgs[curr].style['-webkit-transform']=pgs[next].style['-webkit-transform']='translate3d(0,'+offset+'px,0)';
		}
	},
	release=function(e){
		if(isLock){return;}
		isLock=true;
		con.addEventListener('touchmove', touchMove,false);
		if(Math.abs(offset)<100){//小于50重置
			pgs[curr].className=pgs[curr].className+' restore';
			pgs[act].className=pgs[act].className+' restore';
			pgs[curr].style['-webkit-transform']=pgs[act].style['-webkit-transform']='translate3d(0,0,0)';
			setTimeout(function() {
				pgs[curr].className=pgs[curr].className.replace(' restore','');
				pgs[act].className=pgs[act].className.replace(' restore','');
				pgs[act].style.display='none';
				offset=0;isLock=false;
			}, 310);
		} else {//进行切换
			pgs[curr].className=pgs[curr].className+' moving';
			pgs[act].className=pgs[act].className+' moving';
			pgs[curr].style['-webkit-transform']=pgs[act].style['-webkit-transform']='translate3d(0,'+(offset<0?'-':'')+'100%,0)';
			setTimeout(function() {
				pgs[curr].className=pgs[curr].className.replace(' moving','');
				pgs[act].className=pgs[act].className.replace(' moving','');
				pgs[curr].style.cssText='display:none;top:0;';
				pgs[curr].style['-webkit-transform']=pgs[act].style['-webkit-transform']='translate3d(0,0,0)';
				pgs[act].style.top=0;
				curr=act;prev=curr-1;next=curr+1;
				offset=0;isLock=false;
			}, 210);
		}
		con.removeEventListener('touchmove', touchMove,false);
		con.removeEventListener('touchend', release,false);
		con.removeEventListener('touchcancel', release,false);
	};
	con.addEventListener('touchstart', touchStart,false);
</script>
</body>
</html>